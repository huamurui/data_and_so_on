# 2024-09-09

- 工作内容
  - 1. 权限 & 路由
    - 关键
      - 根据菜单数据去添加路由（也即添加进入某个页面资源的权限）。
      - 路由守卫。
    - 具体实现，代码注意点
      - a. 树形的菜单数据展平，转换成一维数组。
      - b. 路由守卫，每次路由变动时都会执行这个回调函数。
        - 静态、基础路由不需要权限，直接放行。
        - 404 页面虽然不需权限，但需要被放在最后，因为路由匹配是按照顺序的，如果放在前面，那么所有的路由都会被匹配到这个页面。
        - 匹配到非基础页面的路由。  
          - 首先判断是否添加过权限|路由，如果没有，那么就添加，然后再去执行跳转。
          - 如果已经添加过，那么直接跳转。
            - 如果页面存在，权限|路由存在，那么会跳转成功；否则，如果没有权限|路由，即使页面存在，也会跳转到 404 页面。
    - 优化
      - 在 vuex 去请求菜单数据，处理后交给路由去添加菜单，交给菜单组件去渲染菜单。保证生成的菜单与路由是基于同一次请求的数据生成的。
      - vuex 的变量也是有响应式的，并且提供了一个模型来管理数据，保证数据的一致性。也是新建项目时候就有做了一套模板但没怎么用到。
  - 2. 业务理解
    - 以下部分...  是在看旧系统代码时的一些理解，一些地方可能不准确，仅供参考。
    - 报文、报文段
      - InfRecType/MessageType : Info Record Type 信息记录类型/报文类型，通常是一个三位数，前两位表示报文的大类，第三位表示具体的报文类型。
        - 第三位为 0 是原始报文，1 是标识变更请求报文，2 是按段变更请求报文，3 是按段删除请求报文，4 是整笔删除请求报文。
        - 以上，系统 “综合查询” 部分的主要功能便是查看 0 类型的原始报文，创建 1234 类型的变更请求报文。
        - 创建的报文会直接被放入 “历史报文” 中，
      - SegmentCode : 报文段标识码，通常是一个字母，从 “B” 开始，按字母序顺次。
        - 查看报文，变更报文请求，等等操作通常是按照一个报文段为单位进行的，每个报文段在数据库中也基本是对应一个表，前端在查询展示，操作报文时，基本也会根据 InfRecType 和 SegmentCode 来进行。
  - 3. 前端页面代码结构
    - 下面是对前端一个页面的代码结构的一些介绍，可能还有可以优化的地方。
      - props:
        - readonly
        - rowData
      - data:
        - dono
        - owservice_url
        - inferType
        - segmentCode
      - method:
        - 按钮操作
    - 前端给了一个 owservice 的类，用于生成对一个资源的一整套的操作，像 List Get Post Put...
      - 但很多时候，一些单独的像整笔删除，按段删除，按段变更这些按钮对应的服务，只会用到其中的 Post 或 Put 那样一个方法，这时候生成一整套就显得有些没必要。所以在这个类之上暴露成了几个独立的函数，直接用这个函数去调用后端的接口，减少些没有意义的代码。
      - 进一步，把特殊操作的函数放到了一个单独的文件中。也删掉在 data 中 xxx_service_url, 这些服务通常并不会只在一个页面中用到，不同页面可能只是参数传递不同，既然用的同一个，那就直接一个，方便集中查看，统一修改。
